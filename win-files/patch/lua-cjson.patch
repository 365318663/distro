diff --git a/lua-cjson-2.1devel-1.rockspec b/lua-cjson-2.1devel-1.rockspec
index 154e333..ae25872 100644
--- a/lua-cjson-2.1devel-1.rockspec
+++ b/lua-cjson-2.1devel-1.rockspec
@@ -47,6 +47,7 @@ build = {
     -- Override default build options (per platform)
     platforms = {
         win32 = { modules = { cjson = { defines = {
+            "strncasecmp=strnicmp",
             "DISABLE_INVALID_NUMBERS"
         } } } }
     },
diff --git a/strbuf.c b/strbuf.c
index ac779e4..c3272f0 100644
--- a/strbuf.c
+++ b/strbuf.c
@@ -94,8 +94,8 @@ void strbuf_set_increment(strbuf_t *s, int increment)
 static inline void debug_stats(strbuf_t *s)
 {
     if (s->debug) {
-        fprintf(stderr, "strbuf(%lx) reallocs: %d, length: %d, size: %d\n",
-                (long)s, s->reallocs, s->length, s->size);
+        fprintf(stderr, "strbuf(%p) reallocs: %d, length: %d, size: %d\n",
+                s, s->reallocs, s->length, s->size);
     }
 }
 
@@ -168,8 +168,8 @@ void strbuf_resize(strbuf_t *s, int len)
     newsize = calculate_new_size(s, len);
 
     if (s->debug > 1) {
-        fprintf(stderr, "strbuf(%lx) resize: %d => %d\n",
-                (long)s, s->size, newsize);
+        fprintf(stderr, "strbuf(%p) resize: %d => %d\n",
+                s, s->size, newsize);
     }
 
     s->size = newsize;
